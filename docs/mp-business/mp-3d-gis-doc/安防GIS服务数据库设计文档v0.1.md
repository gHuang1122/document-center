## 一、数据库E-R图

![image-20210531141748575](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210531141748575.png)



## 二、数据库表

#### 2.1资源类别表

该项目中，资源的概念相当于一组设备的集合。在园区内一些地方常常会同时部署一组设备，比如园区出入口门岗，通常可能会同时部署摄像头、人员闸机、车辆闸机等一组设备，我们将门岗这类同一个地点对应多个设备的对象看做一个资源。
该表对资源类别进行存储，允许用户定义各种类别的资源。

| 字段名     | 字段中文名       | 字段类型    | 是否为空 | 字段说明 |
| ---------- | ---------------- | ----------- | -------- | -------- |
| id         | ID               | varchar(36) | NOT NULL |          |
| rt_name    | 资源类型名称     | varchar(20) | NOT NULL |          |
| rt_details | 资源类型说明     | varchar(36) |          |          |
| rt_icon    | 资源类型图标路径 | varchar(36) |          |          |

#### 2.2设备类别表

该表存储设备类别，未来设备可能会对接设备管理服务，建议在项目实现时按照微服务方式实现provider和consumer，在consumer中处理设备和点位、资源等信息查询的关联，在未来将设备请求替换成调用设备服务时，可以减少修改。

| 字段名                | 字段中文名           | 字段类型    | 是否为空 | 字段说明 |
| --------------------- | -------------------- | ----------- | -------- | -------- |
| id                    | ID                   | varchar(36) | NOT NULL |          |
| dc_name               | 设备类别名称         | varchar(20) | NOT NULL |          |
| dc_type               | 设备类别类型         | varchar(10) |          |          |
| dc_icon               | 设备类别图标         | varchar(36) |          |          |
| dc_external_contextid | 设备类型外部关联标识 | varchar(10) |          |          |

#### 2.3资源类别-设备类别关系表

该表存储资源类别允许包含的设备的类别。

| 字段名 | 字段中文名 | 字段类型    | 是否为空 | 字段说明 |
| ------ | ---------- | ----------- | -------- | -------- |
| rt_id  | 资源类型ID | varchar(36) | NOT NULL |          |
| dc_id  | 设备类别ID | varchar(36) | NOT NULL |          |

#### 2.4资源表

| 字段名        | 字段中文名 | 字段类型    | 是否为空 | 字段说明 |
| ------------- | ---------- | ----------- | -------- | -------- |
| id            | ID         | varchar(36) | NOT NULL |          |
| rt_id         | 资源类型ID | varchar(36) | NOT NULL |          |
| project_id    | 项目标识   | varchar(36) | NOT NULL |          |
| resource_name | 资源名称   | varchar(20) | NOT NULL |          |
| point_id      | 点位ID     | varchar(36) | NOT NULL |          |
| remark        | 备注       | varchar(36) |          |          |

#### 2.5设备表

| 字段名               | 字段中文名       | 字段类型    | 是否为空 | 字段说明 |
| -------------------- | ---------------- | ----------- | -------- | -------- |
| id                   | ID               | varchar(36) | NOT NULL |          |
| dc_id                | 设备类型ID       | varchar(36) | NOT NULL |          |
| project_id           | 项目标识         | varchar(36) | NOT NULL |          |
| device_name          | 设备名称         | varchar(20) | NOT NULL |          |
| point_id             | 点位ID           | varchar(36) | NOT NULL |          |
| d_external_contextid | 设备外部关联标识 | varchar(36) | NOT NULL |          |

#### 2.6资源-设备关系表

存储指定资源包含哪些设备。

| 字段名     | 字段中文名 | 字段类型    | 是否为空 | 字段说明 |
| ---------- | ---------- | ----------- | -------- | -------- |
| rt_id      | 资源类型ID | varchar(36) | NOT NULL |          |
| dc_id      | 设备类型ID | varchar(36) | NOT NULL |          |
| project_id | 项目标识   | varchar(36) | NOT NULL |          |

#### 2.7点位表

| 字段名      | 字段中文名               | 字段类型    | 是否为空 | 字段说明                                           |
| ----------- | ------------------------ | ----------- | -------- | -------------------------------------------------- |
| id          | ID                       | varchar(36) | NOT NULL |                                                    |
| name        | 名称                     | varchar(20) | NOT NULL |                                                    |
| remark      | 备注                     | varchar(36) |          |                                                    |
| lng         | 经度                     |             |          |                                                    |
| lat         | 纬度                     |             |          |                                                    |
| pointz      | 高程                     |             |          |                                                    |
| max_layer   | 最大显示层级             | varchar(10) | NOT NULL |                                                    |
| category    | 类别（户外，建筑物内部） | varchar(36) |          |                                                    |
| coordinate  | 坐标系类别               | varchar(10) |          |                                                    |
| style_field | 样式字段                 | varchar(36) |          | 以一个json字段存储前端录入该点时设置的各种样式信息 |
| project_id  | 项目标识                 | varchar(36) | NOT NULL |                                                    |

#### 2.8建筑物表

建筑物表的建筑物名称和编号对应了地图3D模型中存储的编号，该编号仅仅在对应模型中唯一。查询时应该根据项目标识加上建筑物编号进行查询。

| 字段名        | 字段中文名 | 字段类型    | 是否为空 | 字段说明 |
| ------------- | ---------- | ----------- | -------- | -------- |
| id            | ID         | varchar(36) | NOT NULL |          |
| building_name | 建筑物名称 | varchar(20) | NOT NULL |          |
| building_no   | 建筑物编号 | varchar(36) |          |          |
| project_id    | 项目标识   | varchar(36) | NOT NULL |          |
| details       | 描述       | varchar(36) |          |          |
| type          | 类型       | varchar(10) |          |          |

#### 2.9楼层表

| 字段名           | 字段中文名     | 字段类型    | 是否为空 | 字段说明 |
| ---------------- | -------------- | ----------- | -------- | -------- |
| building_id      | 建筑物ID       | varchar(36) | NOT NULL |          |
| floor_name       | 楼层名称       | varchar(20) | NOT NULL |          |
| floor_order      | 楼层顺序       | varchar(10) |          |          |
| details          | 说明           | varchar(36) |          |          |
| floor_icon       | 楼层平面图路径 | varchar(36) |          |          |
| floor_coordinate | 楼层坐标系类型 | varchar(10) |          |          |

#### 2.10文字表

文字是地图上直接显示的文字类型的标注。

| 字段名   | 字段中文名 | 字段类型    | 是否为空 | 字段说明                                           |
| -------- | ---------- | ----------- | -------- | -------------------------------------------------- |
| point_id | 点位ID     | varchar(36) | NOT NULL |                                                    |
| name     | 名称       | varchar(20) | NOT NULL |                                                    |
| remark   | 备注       | varchar(36) |          |                                                    |
| style    | 文字样式   | varchar(36) |          | 以一个json字段存储前端录入该点时设置的各种样式信息 |

#### 2.11报警事件表

| 字段名             | 字段中文名   | 字段类型    | 是否为空 | 字段说明 |
| ------------------ | ------------ | ----------- | -------- | -------- |
| id                 | ID           | varchar(36) | NOT NULL |          |
| panalarm_id        | 报警设备ID   | varchar(36) | NOT NULL |          |
| alarm_event        | 报警事件     | varchar(36) |          |          |
| alarm_event_title  | 报警事件标题 | varchar(36) |          |          |
| alarm_type         | 报警类型     | varchar(10) |          |          |
| alarm_info_content | 报警信息内容 | varchar(36) |          |          |
| alarm_point_id     | 报警点位ID   | varchar(36) | NOT NULL |          |
| dispose_status     | 处置情况     | varchar(36) |          |          |
| dispose_details    | 处置方式内容 | varchar(36) |          |          |
| external_id        | 外部关联ID   | varchar(36) | NOT NULL |          |

#### 2.12词典表

该表存储地理信息相关各种添加的字典的名称，和词典项目表共同实现词典信息存储。

| 字段名     | 字段中文名 | 字段类型    | 是否为空 | 字段说明 |
| ---------- | ---------- | ----------- | -------- | -------- |
| id         | ID         | varchar(36) | NOT NULL |          |
| dict       | 词典名称   | varchar(20) | NOT NULL |          |
| project_id | 项目标识   | varchar(36) | NOT NULL |          |

#### 2.13词典项目表

该表存储词典中包含的各个可选项目。

| 字段名    | 字段中文名   | 字段类型    | 是否为空 | 字段说明 |
| --------- | ------------ | ----------- | -------- | -------- |
| id        | ID           | varchar(36) | NOT NULL |          |
| dict_id   | 词典id       | varchar(36) | NOT NULL |          |
| dict_no   | 词典项目编号 | varchar(36) |          |          |
| dict_name | 词典项目名称 | varchar(20) |          |          |
| dict_sort | 词典项目排序 | varchar(36) |          |          |

⦁	对外开放接口列表

| 序号 | 接口名称                                       | 补充说明                                       |
| ---- | ---------------------------------------------- | ---------------------------------------------- |
| 1    | 新增资源类别接口                               |                                                |
| 2    | 查询资源类别列表接口                           |                                                |
| 3    | 查询资源详情接口                               | 结果应当包含该资源类别可以包含的设备类别的列表 |
| 4    | 添加某个资源可以绑定的设备类别                 |                                                |
| 5    | 删除某个资源可以绑定的设备类别                 |                                                |
| 6    | 删除资源类别                                   |                                                |
| 7    | 添加设备类别                                   |                                                |
| 8    | 查看设备类别列表                               |                                                |
| 9    | 根据资源类别查看该资源可以包含的设备类别列表   |                                                |
| 10   | 添加某个类型的资源                             |                                                |
| 11   | 查看指定项目指定地图级别的资源和设备、文字列表 | 包括资源的点位信息，该资源包括的设备列表       |
| 12   | 添加某个资源点下属的设备                       |                                                |
| 13   | 直接在地图上添加某个设备                       |                                                |
| 14   | 移除地图上某个设备                             |                                                |
| 15   | 移除地图上某个资源                             |                                                |
| 16   | 在地图上添加文字                               |                                                |
| 17   | 移除地图上某处文字                             |                                                |

